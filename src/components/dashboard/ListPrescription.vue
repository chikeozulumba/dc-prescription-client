<template>
  <div>
    <h1 class="font-sans text-xl mb-4 text-gray-800 uppercase">Prescriptions ({{ $store.getters.prescriptions.length }})</h1>
    <div v-for="(prescription, index) in $store.getters.prescriptions" :key="index" class="max-w-lg w-full lg:flex border border-gray-400 rounded mb-4">
      <div
        class="bg-white rounded p-4 flex flex-col justify-between leading-normal w-full"
      >
        <div class="">
          <div class="flex justify-between">
            <h3 class="text-gray-800 mb-1 font-bold text-lg capitalize">{{ prescription.title }}</h3>
            <p class="text-black font-bold text-xs lowercase font-mono text-gray-600 inline-flex">
            <span class="mr-2">
              <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve" class="h-4"><g><g>
                <g>
                  <g>
                    <path d="M256,0C114.844,0,0,114.844,0,256s114.844,256,256,256s256-114.844,256-256S397.156,0,256,0z M266.667,490.126v-31.46     c0-5.896-4.771-10.667-10.667-10.667s-10.667,4.771-10.667,10.667v31.46c-120.868-5.473-217.987-102.591-223.46-223.46h31.46     C59.229,266.667,64,261.896,64,256s-4.771-10.667-10.667-10.667h-31.46c5.473-120.868,102.591-217.987,223.46-223.46v31.46     C245.333,59.229,250.104,64,256,64s10.667-4.771,10.667-10.667v-31.46c120.868,5.473,217.987,102.591,223.46,223.46h-31.46     c-5.896,0-10.667,4.771-10.667,10.667s4.771,10.667,10.667,10.667h31.46C484.654,387.535,387.535,484.654,266.667,490.126z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                    <path d="M276.281,261.198c0.441-1.707,1.052-3.355,1.052-5.198c0-4.465-1.698-8.382-4.053-11.811l67.053-143.678     c2.49-5.333,0.188-11.688-5.156-14.177C329.854,83.885,323.5,86.167,321,91.49l-67.005,143.583     c-10.776,1.063-19.328,9.878-19.328,20.927c0,11.76,9.573,21.333,21.333,21.333c1.842,0,3.491-0.611,5.198-1.052l83.26,83.26     c2.083,2.083,4.813,3.125,7.542,3.125c2.729,0,5.458-1.042,7.542-3.125c4.167-4.167,4.167-10.917,0-15.083L276.281,261.198z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                  </g>
                </g>
              </g></g> </svg>
            </span>
            {{ format.formatDistance(new Date(prescription.createdAt), new Date(), {
              addSuffix: true
            }) }}</p>
          </div>
          <div class="flex flex-col">
            <div class="h-4 text-gray-700 inline-flex mb-2" id="">
              <svg xmlns="http://www.w3.org/2000/svg"  height="20px" viewBox="0 0 128 128" width="20px" data-name="Layer 1"><g><path d="m50.868 72.045h-6.628v-6.627a1.75 1.75 0 0 0 -1.75-1.75h-7.475a1.75 1.75 0 0 0 -1.75 1.75v6.627h-6.628a1.75 1.75 0 0 0 -1.75 1.75v7.476a1.75 1.75 0 0 0 1.75 1.75h6.628v6.628a1.75 1.75 0 0 0 1.75 1.75h7.475a1.75 1.75 0 0 0 1.75-1.75v-6.628h6.628a1.75 1.75 0 0 0 1.75-1.75v-7.471a1.75 1.75 0 0 0 -1.75-1.755zm-1.75 7.476h-6.628a1.75 1.75 0 0 0 -1.75 1.75v6.629h-3.975v-6.629a1.75 1.75 0 0 0 -1.75-1.75h-6.628v-3.976h6.628a1.75 1.75 0 0 0 1.75-1.75v-6.627h3.975v6.632a1.75 1.75 0 0 0 1.75 1.75h6.628z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/><path d="m116.051 97.66-7.79-7.614-7.79-7.614a9.3 9.3 0 0 0 -13.131.15l-.329.336a9.274 9.274 0 0 0 -.924 11.868h-17.832v-39.675a15.152 15.152 0 0 0 -5.3-11.518 11.657 11.657 0 0 1 -4.075-8.86v-5.275h2.349a1.75 1.75 0 0 0 1.75-1.75v-11.784a1.75 1.75 0 0 0 -1.75-1.75h-44.956a1.75 1.75 0 0 0 -1.75 1.75v11.784a1.75 1.75 0 0 0 1.75 1.75h2.349v5.275a11.656 11.656 0 0 1 -4.075 8.86 15.154 15.154 0 0 0 -5.3 11.518v49.222a9.5 9.5 0 0 0 9.493 9.493h40.022a9.428 9.428 0 0 0 3.238-.579 9.222 9.222 0 0 0 3.2.579h21.79a9.29 9.29 0 0 0 9.266-8.893l6.492 6.345a9.3 9.3 0 0 0 13.131-.15l.329-.336a9.286 9.286 0 0 0 -.151-13.132zm-26.541-12.3.329-.336a5.794 5.794 0 0 1 8.183-.094l6.54 6.392-8.416 8.612-6.54-6.392a5.786 5.786 0 0 1 -.095-8.182zm-76.76-25.748h52v35.172h-52zm35.389-33.654v-8.284h4.137v8.284zm-7.637 0v-8.284h4.137v8.284zm-7.637 0v-8.284h4.135v8.284zm-7.637 0v-8.284h4.137v8.284zm34.253 0h-3.705v-8.284h3.706zm-41.458-8.284h3.706v8.284h-3.706zm-1.2 28.576a15.151 15.151 0 0 0 5.3-11.517v-5.275h33.26v5.275a15.153 15.153 0 0 0 5.3 11.517 11.656 11.656 0 0 1 4.075 8.86v1h-52v-1a11.659 11.659 0 0 1 4.067-8.86zm-4.073 58.083v-6.049h45.194a9.236 9.236 0 0 0 -2.035 5.787v.469a9.235 9.235 0 0 0 2.035 5.786h-39.2a6 6 0 0 1 -5.994-5.993zm46.658.207v-.469a5.793 5.793 0 0 1 5.786-5.787h9.145v12.042h-9.145a5.793 5.793 0 0 1 -5.786-5.786zm33.362 0a5.793 5.793 0 0 1 -5.786 5.786h-9.145v-12.042h9.145a5.793 5.793 0 0 1 5.786 5.787zm20.929 3.806-.329.336a5.747 5.747 0 0 1 -4.072 1.741 5.607 5.607 0 0 1 -4.11-1.647l-6.54-6.392 8.416-8.612 6.54 6.392a5.787 5.787 0 0 1 .095 8.182z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/></g> </svg>
              <div class="inline-flex font-mono text-sm text-gray-600 ml-2 justify-around">
                <p>{{ prescription.drugName }} <span class="font-mono text-xs text-orange-600">({{ prescription.dosageCompleted }} of {{ prescription.totalDosageCount }} completed)</span></p>
              </div>
            </div>
            <div class="h-4 text-gray-700 inline-flex mb-2">
              <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve" width="18px" height="18px" class=""><g><g>
                <g>
                  <path d="M470.094,49.211C467.776,21.076,452.744,0,433.963,0c-18.778,0-33.812,21.078-36.131,49.211h-17.101    C378.415,21.076,363.382,0,344.601,0c-18.777,0-33.812,21.078-36.131,49.211h-17.1C289.052,21.076,274.019,0,255.238,0    c-18.777,0-33.812,21.078-36.13,49.211h-17.102C199.688,21.076,184.657,0,165.875,0c-18.778,0-33.812,21.078-36.131,49.211    h-17.101C110.326,21.076,95.295,0,76.512,0C57.735,0,42.7,21.078,40.381,49.211H0V512h512V49.211H470.094z M433.963,15.208    c8.972,0,18.852,13.629,20.866,34.003h-41.734C415.112,28.839,424.994,15.208,433.963,15.208z M344.601,15.208    c8.972,0,18.852,13.629,20.866,34.003h-41.734C325.75,28.838,335.633,15.208,344.601,15.208z M255.238,15.208    c8.973,0,18.853,13.629,20.867,34.003h-41.734C236.387,28.839,246.269,15.208,255.238,15.208z M165.875,15.208    c8.972,0,18.852,13.629,20.866,34.003h-41.734C147.024,28.839,156.906,15.208,165.875,15.208z M76.512,15.208    c8.972,0,18.852,13.629,20.867,34.003H55.646C57.661,28.838,67.543,15.208,76.512,15.208z M496.792,496.792H15.208V198.368    h481.584V496.792z M496.792,183.16H15.208v-18.89h481.584V183.16z M496.792,149.065H15.208V64.419h82.171    c-1.986,20.081-11.612,33.597-20.478,33.983c-3.414-8.08-11.419-13.765-20.728-13.765c-12.401,0-22.49,10.089-22.49,22.49    s10.089,22.49,22.49,22.49c10.157,0,18.758-6.77,21.542-16.032c18.217-0.879,32.663-21.635,34.931-49.165h74.098    c-1.807,18.274-9.94,31.12-18.073,33.574c-3.509-7.862-11.395-13.357-20.545-13.357c-12.401,0-22.491,10.089-22.491,22.49    s10.089,22.49,22.491,22.49c10.251,0,18.916-6.896,21.615-16.291c16.95-2.665,30.112-22.73,32.267-48.907h74.099    c-1.924,19.461-11.025,32.759-19.657,33.913c-3.431-8.043-11.416-13.695-20.698-13.695c-12.401,0-22.49,10.089-22.49,22.49    s10.089,22.49,22.49,22.49c10.174,0,18.787-6.792,21.555-16.078c17.808-1.483,31.832-22.026,34.065-49.121h74.098    c-1.867,18.876-10.484,31.96-18.877,33.781c-3.461-7.972-11.408-13.563-20.638-13.563c-12.402,0-22.49,10.089-22.49,22.49    s10.089,22.49,22.49,22.49c10.21,0,18.846-6.841,21.582-16.178c17.395-2.067,31.002-22.368,33.197-49.02h74.098    c-1.83,18.5-10.143,31.43-18.375,33.652c-3.491-7.903-11.4-13.435-20.579-13.435c-12.403,0-22.492,10.089-22.492,22.49    s10.089,22.49,22.492,22.49c10.234,0,18.886-6.873,21.601-16.244c17.117-2.443,30.447-22.597,32.618-48.953h26.697V149.065z     M62.977,109.699c-1.042,2.749-3.695,4.71-6.805,4.71c-4.015,0-7.283-3.267-7.283-7.283c0-2.881,1.686-5.369,4.12-6.55    C55.986,104.432,59.353,107.507,62.977,109.699z M154.381,110.833c-1.27,2.136-3.596,3.575-6.258,3.575    c-4.015,0-7.283-3.267-7.283-7.283c0-2.154,0.946-4.088,2.438-5.422C146.594,105.718,150.35,108.813,154.381,110.833z     M242.394,110.096c-1.14,2.538-3.685,4.313-6.643,4.313c-4.015,0-7.283-3.267-7.283-7.283c0-2.635,1.412-4.941,3.514-6.219    C235.085,104.853,238.609,107.943,242.394,110.096z M332.42,110.46c-1.212,2.342-3.653,3.949-6.467,3.949    c-4.016,0-7.283-3.267-7.283-7.283c0-2.402,1.174-4.529,2.973-5.857C324.855,105.265,328.504,108.363,332.42,110.46z     M422.215,110.696c-1.251,2.213-3.621,3.713-6.34,3.713c-4.016,0-7.284-3.267-7.284-7.283c0-2.248,1.025-4.259,2.63-5.597    C414.502,105.544,418.222,108.644,422.215,110.696z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <polygon points="471.446,442.481 471.446,471.446 433.743,471.446 433.743,486.654 486.654,486.654 486.654,442.481   " data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <rect x="388.745" y="471.446" width="23.43" height="15.208" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <polygon points="25.915,208.673 25.915,252.846 41.123,252.846 41.123,223.881 78.826,223.881 78.826,208.673   " data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <rect x="100.393" y="208.673" width="23.43" height="15.208" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <path d="M265.982,241.074v46.908h90.166v-46.908H265.982z M340.94,272.774h-59.75v-16.492h59.75V272.774z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <path d="M376.115,241.074v46.908h90.166v-46.908H376.115z M451.073,272.774h-59.75v-16.492h59.75V272.774z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <path d="M45.719,302.786v46.908h90.166v-46.908H45.719z M120.677,334.486h-59.75v-16.492h59.75V334.486z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <path d="M155.851,302.786v46.908h90.166v-46.908H155.851z M230.809,334.486h-59.75v-16.492h59.75V334.486z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <path d="M265.982,302.786v46.908h90.166v-46.908H265.982z M340.94,334.486h-59.75v-16.492h59.75V334.486z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <path d="M376.115,302.786v46.908h90.166v-46.908H376.115z M451.073,334.486h-59.75v-16.492h59.75V334.486z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <path d="M45.719,364.497v46.908h90.166v-46.908H45.719z M120.677,396.198h-59.75v-16.492h59.75V396.198z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <path d="M155.851,364.497v46.908h90.166v-46.908H155.851z M230.809,396.198h-59.75v-16.492h59.75V396.198z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <path d="M265.982,364.497v46.908h90.166v-46.908H265.982z M340.94,396.198h-59.75v-16.492h59.75V396.198z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <path d="M376.115,364.497v46.908h90.166v-46.908H376.115z M451.073,396.198h-59.75v-16.492h59.75V396.198z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <path d="M45.719,426.208v46.908h90.166v-46.908H45.719z M120.677,457.909h-59.75v-16.492h59.75V457.909z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <path d="M155.851,426.208v46.908h90.166v-46.908H155.851z M230.809,457.909h-59.75v-16.492h59.75V457.909z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g><g>
                <g>
                  <path d="M265.982,426.208v46.908h90.166v-46.908H265.982z M340.94,457.909h-59.75v-16.492h59.75V457.909z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                </g>
              </g></g> </svg>
              <div class="inline-flex font-mono text-sm text-gray-600 ml-2 justify-around">
                <!-- <p class="mr-1">From</p> -->
                <p>{{ format.format(new Date(prescription.dosageDuration.start), 'do MMMM') }}</p>
                <p class="mx-1">Till</p>
                <p>{{ format.format(new Date(prescription.dosageDuration.end), 'do MMMM') }}</p>
              </div>
            </div>
          </div>
          <!-- <div class="bg-gray-700 divider max-w-sm my-2" /> -->
          <h3 class="uppercase font-mono font-bold my-2 text-xs">
            Upcoming Dosages for today ({{ sortDailyInterval(prescription.dailyInterval).length }})
          </h3>
          <div class="flex flex-row" v-for="(intervalTime, index) in sortDailyInterval(prescription.dailyInterval)" :key="index">
            <span class="mr-2">
              <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve" class="h-4"><g><g>
                <g>
                  <g>
                    <path d="M256,0C114.844,0,0,114.844,0,256s114.844,256,256,256s256-114.844,256-256S397.156,0,256,0z M266.667,490.126v-31.46     c0-5.896-4.771-10.667-10.667-10.667s-10.667,4.771-10.667,10.667v31.46c-120.868-5.473-217.987-102.591-223.46-223.46h31.46     C59.229,266.667,64,261.896,64,256s-4.771-10.667-10.667-10.667h-31.46c5.473-120.868,102.591-217.987,223.46-223.46v31.46     C245.333,59.229,250.104,64,256,64s10.667-4.771,10.667-10.667v-31.46c120.868,5.473,217.987,102.591,223.46,223.46h-31.46     c-5.896,0-10.667,4.771-10.667,10.667s4.771,10.667,10.667,10.667h31.46C484.654,387.535,387.535,484.654,266.667,490.126z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                    <path d="M276.281,261.198c0.441-1.707,1.052-3.355,1.052-5.198c0-4.465-1.698-8.382-4.053-11.811l67.053-143.678     c2.49-5.333,0.188-11.688-5.156-14.177C329.854,83.885,323.5,86.167,321,91.49l-67.005,143.583     c-10.776,1.063-19.328,9.878-19.328,20.927c0,11.76,9.573,21.333,21.333,21.333c1.842,0,3.491-0.611,5.198-1.052l83.26,83.26     c2.083,2.083,4.813,3.125,7.542,3.125c2.729,0,5.458-1.042,7.542-3.125c4.167-4.167,4.167-10.917,0-15.083L276.281,261.198z" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/>
                  </g>
                </g>
              </g></g> </svg>
            </span>
            <p
            class="text-gray-700 text-xs font-mono capitalize"
            >{{ prescription.quantity }} {{ prescription.type }}<span class="lowercase"> by {{ intervalTime.stringValue }} (in {{ format.formatDistance(new Date(), new Date(intervalTime.formattedValue)) }}) </span> </p>
          </div>
          <div id="delete-action">
            <a class="cursor-pointer" @click.prevent="() => deletePrescription(prescription)">
              <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="-40 0 427 427.00131" width="18px"><g><path d="m232.398438 154.703125c-5.523438 0-10 4.476563-10 10v189c0 5.519531 4.476562 10 10 10 5.523437 0 10-4.480469 10-10v-189c0-5.523437-4.476563-10-10-10zm0 0" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/><path d="m114.398438 154.703125c-5.523438 0-10 4.476563-10 10v189c0 5.519531 4.476562 10 10 10 5.523437 0 10-4.480469 10-10v-189c0-5.523437-4.476563-10-10-10zm0 0" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/><path d="m28.398438 127.121094v246.378906c0 14.5625 5.339843 28.238281 14.667968 38.050781 9.285156 9.839844 22.207032 15.425781 35.730469 15.449219h189.203125c13.527344-.023438 26.449219-5.609375 35.730469-15.449219 9.328125-9.8125 14.667969-23.488281 14.667969-38.050781v-246.378906c18.542968-4.921875 30.558593-22.835938 28.078124-41.863282-2.484374-19.023437-18.691406-33.253906-37.878906-33.257812h-51.199218v-12.5c.058593-10.511719-4.097657-20.605469-11.539063-28.03125-7.441406-7.421875-17.550781-11.5546875-28.0625-11.46875h-88.796875c-10.511719-.0859375-20.621094 4.046875-28.0625 11.46875-7.441406 7.425781-11.597656 17.519531-11.539062 28.03125v12.5h-51.199219c-19.1875.003906-35.394531 14.234375-37.878907 33.257812-2.480468 19.027344 9.535157 36.941407 28.078126 41.863282zm239.601562 279.878906h-189.203125c-17.097656 0-30.398437-14.6875-30.398437-33.5v-245.5h250v245.5c0 18.8125-13.300782 33.5-30.398438 33.5zm-158.601562-367.5c-.066407-5.207031 1.980468-10.21875 5.675781-13.894531 3.691406-3.675781 8.714843-5.695313 13.925781-5.605469h88.796875c5.210937-.089844 10.234375 1.929688 13.925781 5.605469 3.695313 3.671875 5.742188 8.6875 5.675782 13.894531v12.5h-128zm-71.199219 32.5h270.398437c9.941406 0 18 8.058594 18 18s-8.058594 18-18 18h-270.398437c-9.941407 0-18-8.058594-18-18s8.058593-18 18-18zm0 0" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/><path d="m173.398438 154.703125c-5.523438 0-10 4.476563-10 10v189c0 5.519531 4.476562 10 10 10 5.523437 0 10-4.480469 10-10v-189c0-5.523437-4.476563-10-10-10zm0 0" data-original="#000000" class="active-path" data-old_color="#000000" fill="#DD6B20"/></g> </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
const dateFns = require('date-fns');

export default {
  name: 'list-prescription',
  data: () => ({
    format: dateFns,
    console,
  }),
  methods: {
    sortDailyInterval(dailyIntervals) {
      return dailyIntervals.filter((intervalTime) => {
        const newDate = new Date(this.parseToToday(intervalTime.stringValue));
        newDate.setHours(newDate.getHours() + 1);
        return dateFns.isAfter(newDate, new Date());
      })
        .map((di) => ({
          ...di,
          formattedValue: new Date(this.parseToToday(di.stringValue)),
        }));
    },
    parseToToday(timeString) {
      const today = new Date();
      const dd = String(today.getDate()).padStart(2, '0');
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const yyyy = today.getFullYear();
      const value = `${yyyy}-${mm}-${dd}T${timeString}:00`;
      return value;
    },
    deletePrescription(prescription) {
      this.$store.dispatch('deletePrescription', prescription)
        .then(() => {
          this.$toast.success(`${prescription.title} removed!`, {
            position: 'top-right',
            duration: 3000,
          });
        });
    },
  },
};
</script>
